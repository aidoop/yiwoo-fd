(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{1209:function(e,t,n){"use strict";n.r(t),n.d(t,"Connection",(function(){return E}));n(597);var r,a,i,o,c,s,d,l,p=n(9),u=n(38),m=n(31),h=n(81),f=n(934),y=n(140),v=n.n(y),g=n(1),b=n(74);function w(e,t,n,r,a,i,o){try{var c=e[i](o),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,a)}function O(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){w(i,r,a,o,c,"next",e)}function c(e){w(i,r,a,o,c,"throw",e)}o(void 0)}))}}function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){j(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}class E extends(Object(b.a)(u.store)(Object(p.b)(p.a)(u.PageView))){static get properties(){return{active:String,searchConfig:Array,gristConfig:Object,connectors:Object}}static get styles(){return[h.c,Object(g.b)(r||(r=x(["\n        :host {\n          display: flex;\n          flex-direction: column;\n\n          overflow: hidden;\n        }\n\n        search-form {\n          overflow: visible;\n        }\n\n        data-grist {\n          overflow-y: auto;\n          flex: 1;\n        }\n      "])))]}get context(){return{title:p.a.t("text.connection list"),help:"integration/ui/connection",actions:[_({title:p.a.t("button.save"),action:this._updateConnectionManager.bind(this)},h.a.save),_({title:p.a.t("button.delete"),action:this._deleteConnectionManager.bind(this)},h.a.delete)]}}render(){var e=this;return Object(g.e)(a||(a=x(['\n      <search-form\n        id="search-form"\n        .fields=',"\n        @submit=","\n      ></search-form>\n\n      <data-grist\n        .mode=","\n        .config=","\n        .fetchHandler=","\n      ></data-grist>\n    "])),this.searchConfig,O((function*(){return e.dataGrist.fetch()})),Object(m.j)()?"LIST":"GRID",this.gristConfig,this.fetchHandler.bind(this))}get searchForm(){return this.shadowRoot.querySelector("search-form")}get dataGrist(){return this.shadowRoot.querySelector("data-grist")}pageInitialized(){var e=this;return O((function*(){var t;e.fetchConnectors(),e.searchConfig=[{name:"name",type:"text",props:{placeholder:p.a.t("field.name"),searchOper:"like"}},{name:"description",type:"text",props:{placeholder:p.a.t("field.description"),searchOper:"like"}},{name:"type",type:"text",props:{placeholder:p.a.t("field.type"),searchOper:"like"}},{name:"endpoint",type:"text",props:{placeholder:p.a.t("field.endpoint"),searchOper:"like"}}],e.gristConfig={list:{fields:["name","description","type"]},columns:[{type:"gutter",gutterName:"sequence"},{type:"gutter",gutterName:"row-selector",multiple:!0},{type:"gutter",gutterName:"button",name:"state",icon:e=>e&&"CONNECTED"==e.state?"link_off":"link",handlers:{click:(t,n,r,a,i)=>{a&&a.name&&"+"!=a.__dirty__&&("CONNECTED"==a.state?e.disconnect(a):e.connect(a))}}},{type:"object",name:"domain",hidden:!0},{type:"string",name:"name",header:p.a.t("field.name"),record:{editable:!0},sortable:!0,width:150,validation:function(e,t,n,r){return"CONNECTED"!=n.state||(document.dispatchEvent(new CustomEvent("notify",{detail:{level:"warn",message:"connection name cannot be changed during connected."}})),!1)}},{type:"string",name:"description",header:p.a.t("field.description"),record:{editable:!0},width:200},{type:"checkbox",name:"active",header:p.a.t("field.active"),record:{editable:!0},sortable:!0,width:60},{type:"connector",name:"type",header:p.a.t("field.type"),record:{renderer:f.a,editable:!0,help:t=>{var n,r;return null===(n=e.connectors)||void 0===n||null===(r=n[t])||void 0===r?void 0:r.help}},sortable:!0,width:200},{type:"string",name:"endpoint",header:p.a.t("field.endpoint"),record:{editable:!0},sortable:!0,width:200},{type:"parameters",name:"params",header:p.a.t("field.params"),record:{editable:!0,options:(t=O((function*(t,n,r,a,i){var o,{name:c,help:s,parameterSpec:d}=r.type?null===(o=e.connectors)||void 0===o?void 0:o[r.type]:{};return{name:c,help:s,spec:d,context:e.dataGrist}})),function(e,n,r,a,i){return t.apply(this,arguments)})},width:100},{type:"object",name:"updater",header:p.a.t("field.updater"),record:{editable:!1},sortable:!0,width:120},{type:"datetime",name:"updatedAt",header:p.a.t("field.updated_at"),record:{editable:!1},sortable:!0,width:180}],rows:{selectable:{multiple:!0}},sorters:[{name:"name"}]},yield e.updateComplete,e.dataGrist.fetch()}))()}pageUpdated(e,t){var n=this;return O((function*(){n.active&&(yield n.updateComplete,n.dataGrist.fetch())}))()}fetchHandler({page:e,limit:t,sorters:n=[]}){var r=this;return O((function*(){var a=yield u.client.query({query:v()(i||(i=x(["\n        query($filters: [Filter], $pagination: Pagination, $sortings: [Sorting]) {\n          responses: connections(filters: $filters, pagination: $pagination, sortings: $sortings) {\n            items {\n              id\n              domain {\n                id\n                name\n                description\n              }\n              name\n              description\n              type\n              endpoint\n              active\n              state\n              params\n              updater {\n                id\n                name\n                description\n              }\n              updatedAt\n            }\n            total\n          }\n        }\n      "]))),variables:{filters:r._conditionParser(),pagination:{page:e,limit:t},sortings:n}});return{total:a.data.responses.total||0,records:a.data.responses.items||[]}}))()}fetchConnectors(){var e=this;return O((function*(){var t=yield u.client.query({query:v()(o||(o=x(["\n        query {\n          connectors {\n            items {\n              name\n              help\n              parameterSpec {\n                type\n                name\n                label\n                placeholder\n                property\n              }\n            }\n          }\n        }\n      "])))});t.errors?console.error("fetch connectors error"):e.connectors=t.data.connectors.items.reduce((e,t)=>(e[t.name]=t,e),{})}))()}_conditionParser(){return this.searchForm.getFields().filter(e=>"checkbox"!==e.type&&e.value&&""!==e.value||"checkbox"===e.type).map(e=>({name:e.name,value:"text"===e.type?e.value:"checkbox"===e.type?e.checked:"number"===e.type?parseFloat(e.value):e.value,operator:e.getAttribute("searchOper")}))}_deleteConnectionManager(e){var t=this;return O((function*(){if(confirm(p.a.t("text.sure_to_x",{x:p.a.t("text.delete")}))){var e=t.dataGrist.selected.map(e=>e.name);if(e&&e.length>0)(yield u.client.mutate({mutation:v()(c||(c=x(["\n            mutation($names: [String]!) {\n              deleteConnectionManager(names: $names)\n            }\n          "]))),variables:{names:e}})).errors||(t.dataGrist.fetch(),yield document.dispatchEvent(new CustomEvent("notify",{detail:{message:p.a.t("text.info_x_successfully",{x:p.a.t("text.delete")})}})))}}))()}stateChanged(e){var t=this;return O((function*(){t.active&&t._currentPopupName&&!e.layout.viewparts[t._currentPopupName]&&(t.dataGrist.fetch(),t._currentPopupName=null)}))()}_updateConnectionManager(){var e=this;return O((function*(){var t=e.dataGrist.dirtyRecords;t&&t.length&&(t=t.map(e=>{var t=e.id?{id:e.id}:{},n=e.__dirtyfields__;for(var r in n)t[r]=n[r].after;return t.cuFlag=e.__dirty__,t}),(yield u.client.mutate({mutation:v()(s||(s=x(["\n          mutation($patches: [ConnectionPatch]!) {\n            updateMultipleConnection(patches: $patches) {\n              name\n            }\n          }\n        "]))),variables:{patches:t}})).errors||e.dataGrist.fetch())}))()}connect(e){var t=this;return O((function*(){var n=(yield u.client.mutate({mutation:v()(d||(d=x(["\n        mutation($name: String!) {\n          connectConnection(name: $name) {\n            state\n          }\n        }\n      "]))),variables:{name:e.name}})).data.connectConnection.state;e.state=n,t.dataGrist.refresh(),document.dispatchEvent(new CustomEvent("notify",{detail:{level:"info",message:"".concat("CONNECTED"==n?"success":"fail"," to connect : ").concat(e.name)}}))}))()}disconnect(e){var t=this;return O((function*(){var n=(yield u.client.mutate({mutation:v()(l||(l=x(["\n        mutation($name: String!) {\n          disconnectConnection(name: $name) {\n            state\n          }\n        }\n      "]))),variables:{name:e.name}})).data.disconnectConnection.state;e.state=n,t.dataGrist.refresh(),document.dispatchEvent(new CustomEvent("notify",{detail:{level:"info",message:"".concat("CONNECTED"==n?"fail":"success"," to disconnect : ").concat(e.name)}}))}))()}}window.customElements.define("connection-page",E)}}]);