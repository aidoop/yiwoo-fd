(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{1232:function(e,t,r){"use strict";r.r(t);var n,a,i=r(1),s=r(74),o=r(140),c=r.n(o),l=r(38),u=r(31),d=r(81),p=r(9);r(964),r(597);function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){f(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function g(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var b,y,O,v,w=[{type:"gutter",gutterName:"dirty"},{type:"gutter",gutterName:"sequence"},{type:"gutter",gutterName:"row-selector",multiple:!0},{type:"gutter",gutterName:"button",icon:"edit"}],j={pages:[20,30,50,100,200]};class _ extends i.a{static get styles(){return Object(i.b)(n||(n=g(["\n      :host {\n        display: flex;\n        flex-direction: row;\n      }\n\n      data-grist {\n        flex: 1;\n      }\n    "])))}static get properties(){return{mode:String,columns:Array,_config:Object,fetchHandler:Object,fetchOptions:Object,editHandler:Object}}render(){return Object(i.e)(a||(a=g(["\n      <data-grist\n        .mode=","\n        .config=","\n        .editHandler=","\n        .fetchHandler=","\n        .fetchOptions=","\n      >\n      </data-grist>\n    "])),this.mode,this._config,this.editHandler,this.fetchHandler,this.fetchOptions)}get dataGrist(){return this.shadowRoot.querySelector("data-grist")}fetch(){this.dataGrist.fetch()}get data(){return this.dataGrist._data}buildConfig(){var e=this.columns.map(e=>{var{name:t,gridWidth:r,gridAlign:n,term:a}=e,i=e.refType&&e.refType.toLowerCase(),s=e.colType;return(i&&"entity"===i||"menu"===i)&&(s="object"),{name:t,type:s,hidden:!1,width:r,resizable:!0,sortable:!0,header:a,record:{align:n}}}),t=this.columns.filter(e=>e.sortRank).map(e=>({name:e.name,descending:!!e.reverseSort}));return{columns:[...w,...e],pagination:m(m({},j),{},{infinite:!1}),rows:{appendable:!0,insertable:!0,selectable:{multiple:!0}},sorters:t}}updated(e){e.has("columns")&&(this._config=this.buildConfig())}}function R(e,t,r,n,a,i,s){try{var o=e[i](s),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(n,a)}function x(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function s(e){R(i,n,a,s,o,"next",e)}function o(e){R(i,n,a,s,o,"throw",e)}s(void 0)}))}}function k(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function P(e){if(e.indexOf("_")>0){var t=e.split("_");e=t.map((e,t)=>(t>0&&(e=e.replace(e[0],e[0].toUpperCase())),e)).join("")}return e}customElements.define("data-list-wrapper",_);class q extends(Object(s.a)(l.store)(l.PageView)){static get styles(){return[d.c,Object(i.b)(b||(b=k(["\n        :host {\n          display: flex;\n          flex-direction: column;\n\n          overflow: hidden;\n        }\n\n        search-form {\n          overflow: visible;\n        }\n\n        data-list-wrapper {\n          flex: 1;\n\n          overflow: hidden;\n        }\n      "])))]}static get properties(){return{resourceId:String,_searchFields:Array,_columns:Array}}get context(){return{title:this.menuTitle,exportable:{name:this.menuTitle,data:this._exportableData.bind(this)},importable:{handler:()=>{}},printable:{accept:["paper","preview"],content:()=>this},actions:(this.buttons||[]).map(e=>({title:e.text,action:e.action}))}}firstUpdated(){p.a.store.on("added",(e,t)=>{console.trace("이 메시지 발생 시 꼭 확인되어야 함."),this._parseResourceMeta()})}_exportableData(){return this.dataList.exportRecords()}render(){return Object(i.e)(y||(y=k(['\n      <search-form\n        id="search-form"\n        .fields=','\n        initFocus="description"\n        @submit=',"\n      ></search-form>\n\n      <data-list-wrapper\n        pulltorefresh\n        .mode=","\n        .columns=","\n        .records=","\n        .fetchHandler=","\n      >\n      </data-list-wrapper>\n    "])),this._searchFields,e=>this.dataList.fetch(),Object(u.j)()?"LIST":"GRID",this._columns,this.items,this.fetchHandler.bind(this))}fetchHandler({page:e,limit:t,sorters:r=[]}){var n=this;return x((function*(){if(n.resourceUrl){var a=yield l.client.query({query:c()(O||(O=k(["\n        ","\n      "])),n._queryBuilder({page:e,limit:t,sorters:r,filters:n.buildFilters()}))});return{total:a.data.response.total||0,page:e,limit:t,records:a.data.response.items||[]}}}))()}get searchForm(){return this.shadowRoot.querySelector("#search-form")}get dataList(){return this.shadowRoot.querySelector("data-list-wrapper")}_getResourceData(){var e=this;return x((function*(){e.columns=[];var t=yield l.client.query({query:c()(v||(v=k(['\n        query {\n          menu(name: "','") {\n            name,\n            resourceUrl,\n            buttons {\n              text\n            },\n            columns {\n              name\n              term\n              colType\n              colSize\n              nullable\n              refType\n              refName\n              refUrl\n              refRelated\n              searchRank\n              sortRank\n              reverseSort\n              searchEditor\n              searchOper\n              searchInitVal\n              gridRank\n              gridEditor\n              gridFormat\n              gridValidator\n              gridWidth\n              gridAlign\n              formEditor\n              formValidator\n              formFormat\n              defVal\n              rangeVal\n              ignoreOnSave\n            }\n          }\n        }\n      '])),e.resourceId)});e.menuMeta=t.data.menu,e.menuTitle=e.menuMeta.name,e.resourceUrl=P(e.menuMeta.resourceUrl),e.searchForm.form.reset(),e._parseResourceMeta(),e.updateContext()}))()}_parseResourceMeta(){if(this.menuMeta){var e=this.menuMeta;this._columns=e.columns.filter(e=>e.gridRank>0).map(e=>(e.term=p.a.t(e.term),e)).sort((e,t)=>e.gridRank>t.gridRank?1:-1),this.buttons=e.buttons,this._searchFields=e.columns.filter(e=>e.searchRank&&e.searchRank>0).sort((e,t)=>e.searchRank>t.searchRank?1:-1).map(e=>({name:e.name,type:e.searchEditor?e.searchEditor:"text",props:{min:e.rangeVal?e.rangeVal.split(",")[0]:null,max:e.rangeVal?e.rangeVal.split(",")[1]:null,searchOper:e.searchOper?e.searchOper:"eq",placeholder:e.term},value:e.searchInitVal}))}}_queryBuilder({page:e,limit:t,sorters:r,filters:n}){var a=this._columns&&this._columns.length>0?this._columns.map(e=>"Entity"==e.refType||"Menu"==e.refType?"".concat(P(e.name).replace("Id","")," { id name description }"):P(e.name)).join():"id";return"\n    query {\n      response: ".concat(this.resourceUrl," (\n        ").concat(u.g.buildArgs({filters:n,pagination:{limit:t,page:e},sortings:r.map(e=>({name:e.name,desc:!!e.descending}))}),"\n      ) {\n        items {\n          ").concat(a,"\n        }\n        total\n      }\n    }\n  ")}buildFilters(){var e=[];return this.searchForm.formFields.forEach(t=>{t.value&&e.push({name:t.name,operator:t.getAttribute("searchOper"),value:t.value,dataType:this._columns.find(e=>e.name===t.name).colType})}),e}stateChanged(e){this.resourceId=e.route.resourceId}updated(e){e.has("resourceId")&&this._getResourceData()}}window.customElements.define("resource-ui",q)}}]);