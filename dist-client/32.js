(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{1231:function(e,t,n){"use strict";n.r(t),n.d(t,"DomainManagement",(function(){return E}));n(597);var a,r,i,o,s,c,d,l,u=n(9),p=n(38),m=n(31),f=n(81),h=n(140),b=n.n(h),v=n(1),g=n(74),y=n(48);n(89);function w(e,t,n,a,r,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(a,r)}function O(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}class j extends(Object(u.b)(u.a)(v.a)){static get properties(){return{}}static get styles(){return[Object(v.b)(a||(a=O(["\n        :host {\n          display: flex;\n          flex-direction: column;\n          background-color: var(--main-section-background-color);\n          padding: var(--padding-wide);\n          overflow: auto;\n        }\n        input.checkValidName {\n          background-color: #fce6e6;\n        }\n        mwc-button {\n          display: flex;\n          justify-content: center;\n        }\n        label {\n          display: flex;\n          flex-direction: column;\n\n          font: var(--label-font);\n          color: var(--label-color);\n          text-transform: var(--label-text-transform);\n        }\n        input {\n          border: var(--border-dark-color);\n          border-radius: var(--border-radius);\n          margin: var(--input-margin);\n          padding: var(--input-padding);\n          background-color: var(--theme-white-color);\n          font: var(--input-font);\n\n          flex: 1;\n        }\n        [field] {\n          grid-column: span 2;\n        }\n      "])))]}render(){return Object(v.e)(r||(r=O(['\n      <div field grid-span>\n        <label>domain name<input type="text" name="name" @input=',' /></label>\n      </div>\n\n      <div field grid-span>\n        <label>description<input type="text" name="description" /></label>\n      </div>\n\n      <div>\n        <mwc-button raised @click=',">","</mwc-button>\n      </div>\n    "])),this.checkValidation,e=>this.onCreateDomain(),u.a.t("button.create"))}get inputData(){return this.renderRoot.querySelectorAll("input")}checkValidation(e){var t=e.currentTarget;/^[a-zA-Z ]+$/.test(t.value)?t.classList.remove("checkValidName"):t.classList.add("checkValidName")}onCreateDomain(){var e,t=this;return(e=function*(){var e={};if(t.inputData.forEach(t=>e[t.name]=t.value),!/^[a-zA-z ]+$/.test(e.name))return t.showToast(u.a.t("error: domain name should consist only of letters or dashes"));(yield p.client.mutate({mutation:b()(i||(i=O(["\n        mutation domainRegister($domainInput: DomainInput) {\n          domainRegister(domainInput: $domainInput) {\n            id\n            name\n          }\n        }\n      "]))),variables:{domainInput:e}})).errors||(yield Object(p.CustomAlert)({type:"success",title:u.a.t("text.completed"),text:u.a.t("text.created_successfully"),confirmButton:{text:u.a.t("button.confirm")}}),history.back(),t.dispatchEvent(new CustomEvent("fetch-data")))},function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function o(e){w(i,a,r,o,s,"next",e)}function s(e){w(i,a,r,o,s,"throw",e)}o(void 0)}))})()}showToast(e){document.dispatchEvent(new CustomEvent("notify",{detail:{message:e}}))}}function x(e,t,n,a,r,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(a,r)}function k(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function o(e){x(i,a,r,o,s,"next",e)}function s(e){x(i,a,r,o,s,"throw",e)}o(void 0)}))}}function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}window.customElements.define("create-domain-popup",j);class E extends(Object(g.a)(p.store)(Object(u.b)(u.a)(p.PageView))){static get properties(){return{active:String,_searchFields:Array,config:Object}}static get styles(){return[f.c,Object(v.b)(o||(o=$(["\n        :host {\n          display: flex;\n          flex-direction: column;\n\n          overflow: hidden;\n        }\n\n        search-form {\n          overflow: visible;\n        }\n\n        data-grist {\n          overflow-y: auto;\n          flex: 1;\n        }\n      "])))]}get context(){return{title:u.a.t("text.domain management"),actions:[P({title:u.a.t("button.save"),action:this.onUpdateDomains.bind(this)},f.a.save),P({title:u.a.t("button.add"),action:this.onCreateDomain.bind(this)},f.a.add)]}}render(){var e=this;return Object(v.e)(s||(s=$(['\n      <search-form\n        id="search-form"\n        .fields=',"\n        @submit=","\n      ></search-form>\n\n      <data-grist\n        .mode=","\n        .config=",'\n        .fetchHandler="','"\n      ></data-grist>\n    '])),this._searchFields,k((function*(){return e.dataGrist.fetch()})),Object(m.j)()?"LIST":"GRID",this.config,this.fetchHandler.bind(this))}get searchForm(){return this.shadowRoot.querySelector("search-form")}get dataGrist(){return this.shadowRoot.querySelector("data-grist")}pageInitialized(){var e=this;return k((function*(){e._searchFields=[{name:"name",type:"text",props:{placeholder:u.a.t("field.name"),searchOper:"i_like"}},{name:"description",type:"text",props:{placeholder:u.a.t("field.description"),searchOper:"i_like"}},{name:"subdomain",type:"text",props:{placeholder:u.a.t("field.subdomain"),searchOper:"i_like"}}],e.config={rows:{appendable:!1},columns:[{type:"gutter",gutterName:"sequence"},{type:"gutter",gutterName:"button",icon:"domain",handlers:{click:(e,t,n,a,r)=>{if(a.id){var i=a.subdomain;location.pathname="/domain/".concat(i,"/users")}}}},{type:"string",name:"name",header:u.a.t("field.name"),record:{editable:!1},width:200},{type:"string",name:"description",header:u.a.t("field.description"),record:{editable:!0},width:200},{type:"string",name:"subdomain",header:u.a.t("field.subdomain"),record:{editable:!1},width:200},{type:"select",name:"extType",header:u.a.t("field.type"),record:{editable:!0,options:[]},width:70},{type:"datetime",name:"updatedAt",header:u.a.t("field.updated_at"),width:180}]},yield e.updateComplete,e.dataGrist.fetch()}))()}pageUpdated(e,t){var n=this;return k((function*(){n.active&&(yield n.updateComplete,n.dataGrist.fetch())}))()}fetchHandler({page:e,limit:t,sorters:n=[]}){var a=this;return k((function*(){var r,i=(null===(r=a.searchForm)||void 0===r?void 0:r.queryFilters)||[],o=yield p.client.query({query:b()(c||(c=$(["\n        query($filters: [Filter], $pagination: Pagination, $sortings: [Sorting]) {\n          domains(filters: $filters, pagination: $pagination, sortings: $sortings) {\n            items {\n              id\n              name\n              description\n              subdomain\n              extType\n              updatedAt\n            }\n            total\n          }\n        }\n      "]))),variables:{filters:i,pagination:{page:e,limit:t},sortings:n}});return{total:o.data.domains.total||0,records:o.data.domains.items||[]}}))()}onUpdateDomains(){var e=this;return k((function*(){var t=e.dataGrist.dirtyRecords;if(t&&t.length&&(t=t.map(e=>{var t=e.id?{id:e.id}:{},n=e.__dirtyfields__;for(var a in n)t[a]=n[a].after;return P({},t)}),!(yield p.client.mutate({mutation:b()(d||(d=$(["\n          mutation updateDomains($patches: [DomainPatch]!) {\n            updateDomains(patches: $patches)\n          }\n        "]))),variables:{patches:t}})).errors))return e.showToast(u.a.t("text.updated_successfully"))}))()}onCreateDomain(){var e=this;return k((function*(){Object(y.j)(Object(v.e)(l||(l=$(["\n        <create-domain-popup\n          @fetch-data=","\n        ></create-domain-popup>\n      "])),k((function*(){e.dataGrist.fetch()}))),{size:"small",title:"".concat(u.a.t("title.create_domain"))})}))()}showToast(e){document.dispatchEvent(new CustomEvent("notify",{detail:{message:e}}))}}window.customElements.define("domain-management",E)}}]);